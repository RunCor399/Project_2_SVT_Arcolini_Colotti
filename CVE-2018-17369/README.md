# CVE-2018-17369

<font size=3>

1. [Contents](#Contents)
    - [Exploit Directory](#exploit-directory)
    - [VulnerableFramework Directory](#vulnerableframework-directory)
2. [The CVE](#the-cve)
    - [Details](#details)
    - [Root Cause of the Vulnerability](#root-cause-of-the-vulnerability)
    - [Potential Attack Scenario](#potential-attack-scenario)
3. [The Vulnerable Framework](#the-vulnerable-framework)
    - [Description](#description)
    - [Build Instructions](#build-instructions)
    - [Deployment Instructions](#deployment-instructions)
    - [Static Analysis Results](#static-analysis-results)
        - [Spotbugs](#spotbugs)
        - [SonarQube](#sonarqube)
        - [Security Hotspots Analysis](#security-hotspots-analysis)
    - [CVE Vulnerabilities](#cve-vulnerabilities)
4. [Exploitation of the Vulnerability](#exploitation-of-the-vulnerability)
    - [Running the Framework](#running-the-framework)
    - [Exploit the Framework](#exploit-the-framework)
    - [Analysis of the Exploitation Outcome](#analysis-of-the-exploitation-outcome)
5. [Possible Security Patch](#possible-security-patch)

</font>

## **Contents**
### **Exploit Directory**
This directory contains a single **python script** named **exploit.py** that will be used to trigger a specific vulnerability found in the application. Furthermore it is also present a **README.md** file that shows how to execute the python script.



### **VulnerableFramework Directory**
**VulnerableFramework** directory contains three different subdirectories:

- **Docker**: contains a collection of scripts and configuration files that will be used to properly run the vulnerable framework in a dockerized enviroment.


- **spring-boot-authority**: contains the **spring-boot-authority** projects sources from which the framework can be built.

- **jar**: contains a jar file of the application.


Additional information about the **Docker** directory contents as well as information on how to deploy the framework, can be obtained by reading the **README.md** file within this same folder.



## **The CVE**
### **Details**
In this section a detailed description of **CVE-2018-17369** will be provided, the following is a first description provided by the NIST:

> An issue was discovered in springboot_authority through 2017-03-06. There is stored XSS via the admin/role/edit roleKey, name, or description parameter.

This CVE refers to an open source project called [Spring-Boot-Authority](https://github.com/qzw1210/springboot_authority) that contains multiple **Stored XSS** vulnerabilities that were flagged in a Github [issue](https://github.com/qzw1210/springboot_authority/issues/4) by a project contributor.


### **Root Cause of the Vulnerability**
The root cause of the multiple Stored XSS vulnerabilities is that when a **User**, **Role** or **Resource** is created or edited, there is no sanitization of any of the parameters provided by the user. When these inputs get inserted into the DOM of the page they may trigger a code injection vulnerability if crafted in a specific way.

In the two following screenshots it is possible to notice how the parameters of a new user are directly mapped to a **User** object (UserController), and how **User** object fields are immediately updated in the Database (UserService) with no input sanitization of any kind.

**UserController.java**
</br>

![Vulnerable Code User Controller](./images/spauth_root_cause_user.png)

</br>


**UserService.java**
</br>

![Vulnerable Code User Service](./images/spauth_root_cause_user_service.png)

</br>

### **Potential Attack Scenario**
As a potential attack scenario we could think about the situation in which a **Spring Boot** application is using this framework for **user, resources and roles management**.

In order for the attack to be feasible there is only one requirement: the attacker must be authenticated to the backend management system and able to create or edit new users, resources or roles




## **The Vulnerable Framework**
### **Description**
[CVE-2018-17368](https://nvd.nist.gov/vuln/detail/CVE-2018-17369) was specifically issued for the framework I've decided to analyze in this report. The project is named [SpringBoot_Authority](https://github.com/qzw1210/springboot_authority): an open source **Background Management System** used for managing **Users**, **Resources** and **Roles**.


</br>

After having [deployed the framework](#deployment-instructions), the following login page can be retrieved at the URL **http://localhost:8080/admin/login**.

</br>

**Login Page**

![Login Page](./images/spauth_login.png)

</br>

By using as username "**admin**" and as password "**111111**", you will be redirected to the homepage shown here below:

![Homepage](./images/spauth_homepage.png)

</br></br>

To access the various menus just **expand System Management** option inside the **left sidebar**, and select one among **User Management**, **Role Management** or **Resource Management**

</br>

![Menu](./images/spauth_menu.png)

</br>

### **Build Instructions**

### **Deployment Instructions**

### **Static Analysis Results**
#### **Spotbugs**
#### **SonarQube**
#### **Security Hotspots Analysis**
### **CVE Vulnerabilities**

## **Exploitation of the Vulnerability**
### **Running the Framework**

### **Exploit the Framework**
#### **Manual Exploitation**
#### **Automatic Exploitation**

### **Analysis of the Exploitation Outcome**

## **Possible Security Patch**